import { extendActivitiesWithUIData } from "./extendActivitiesWithUIData";
import { mergeActivityDataWithMetadata } from "./mergeActivityDataWithMetadata";
import { sampleMetadataResponse } from "../../../../../__mocks__/fixtures/sampleMetadataResponse";
import { sampleActivitiesResponse, sampleActivitiesWithRepetiveResponse } from "../../../../../__mocks__/fixtures/sampleActivitiesResponse";

describe("extendActivitiesWithUIData", () => {
    it("should render activities with metadata when items are not grouped", () => {
        const activitiesDataWithMetadata = mergeActivityDataWithMetadata(sampleActivitiesResponse, sampleMetadataResponse);

        const expected = [
            {
                uiType: "date",
                value: "2024-09-26",
            },
            {
                actions: [],
                activities: {
                    displayableName: "Scenario unarchived",
                    icon: "/assets/process/success.svg",
                    supportedActions: [],
                    type: "SCENARIO_UNARCHIVED",
                },
                additionalFields: [],
                attachment: null,
                comment: null,
                date: "2024-09-26T10:26:42.999982Z",
                id: "1ba9d6c6-c61a-42f5-8311-4d0f287867f7",
                isActiveFound: false,
                isFound: false,
                isHidden: false,
                overrideDisplayableName: null,
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 6,
                type: "SCENARIO_UNARCHIVED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [],
                activities: {
                    displayableName: "Scenario archived",
                    icon: "/assets/process/archived.svg",
                    supportedActions: [],
                    type: "SCENARIO_ARCHIVED",
                },
                additionalFields: [],
                attachment: null,
                comment: null,
                date: "2024-09-26T10:26:28.293423Z",
                id: "ec245dc5-f84c-4880-8727-b8c999c35a3f",
                isActiveFound: false,
                isFound: false,
                isHidden: false,
                overrideDisplayableName: null,
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 6,
                type: "SCENARIO_ARCHIVED",
                uiType: "item",
                user: "admin",
            },
            {
                uiType: "date",
                value: "2024-09-22",
            },
            {
                actions: [
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_comment",
                    },
                    {
                        displayableName: "Edit",
                        icon: "/assets/states/error.svg",
                        id: "edit_comment",
                    },
                    {
                        displayableName: "Compare",
                        icon: "/assets/states/error.svg",
                        id: "compare",
                    },
                ],
                activities: {
                    displayableName: "New version saved",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["delete_comment", "edit_comment", "compare"],
                    type: "SCENARIO_MODIFIED",
                },
                additionalFields: [],
                attachment: null,
                comment: {
                    content: {
                        status: "AVAILABLE",
                        value: "122",
                    },
                    lastModifiedAt: "2024-09-25T09:55:04.309Z",
                    lastModifiedBy: "admin",
                },
                date: "2024-09-25T09:55:04.309Z",
                id: "15c0e8a9-d1c5-47dd-bf28-8a08217fff5b",
                isActiveFound: false,
                isFound: false,
                isHidden: false,
                overrideDisplayableName: "Version 4 saved",
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 4,
                type: "SCENARIO_MODIFIED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_comment",
                    },
                    {
                        displayableName: "Edit",
                        icon: "/assets/states/error.svg",
                        id: "edit_comment",
                    },
                    {
                        displayableName: "Compare",
                        icon: "/assets/states/error.svg",
                        id: "compare",
                    },
                ],
                activities: {
                    displayableName: "New version saved",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["delete_comment", "edit_comment", "compare"],
                    type: "SCENARIO_MODIFIED",
                },
                additionalFields: [],
                attachment: null,
                comment: {
                    content: {
                        status: "AVAILABLE",
                        value: "tests save",
                    },
                    lastModifiedAt: "2024-09-22T09:53:40.875721Z",
                    lastModifiedBy: "admin",
                },
                date: "2024-09-22T09:53:40.875721Z",
                id: "a2576467-9bf9-4a92-b71f-be95b84d59f6",
                isActiveFound: false,
                isFound: false,
                isHidden: false,
                overrideDisplayableName: "Version 3 saved",
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 3,
                type: "SCENARIO_MODIFIED",
                uiType: "item",
                user: "admin",
            },
            {
                uiType: "date",
                value: "2022-01-22",
            },
            {
                actions: [
                    {
                        displayableName: "Download",
                        icon: "/assets/states/error.svg",
                        id: "download_attachment",
                    },
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_attachment",
                    },
                ],
                activities: {
                    displayableName: "Attachment",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["download_attachment", "delete_attachment"],
                    type: "ATTACHMENT_ADDED",
                },
                additionalFields: [],
                attachment: {
                    file: {
                        id: 1,
                        status: "AVAILABLE",
                    },
                    filename: "324.log",
                    lastModifiedAt: "2022-01-22T06:09:44.313094Z",
                    lastModifiedBy: "admin",
                },
                comment: null,
                date: "2022-01-22T06:09:44.313094Z",
                id: "48f383f9-ccdd-46b6-9b33-5f6693165755",
                isActiveFound: false,
                isFound: false,
                isHidden: false,
                overrideDisplayableName: null,
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 1,
                type: "ATTACHMENT_ADDED",
                uiType: "item",
                user: "admin",
            },
        ];

        expect(extendActivitiesWithUIData(activitiesDataWithMetadata)).toMatchObject(expected);
    });
    it("should render activities with metadata when items are grouped and date range is visible", () => {
        const activitiesDataWithMetadata = mergeActivityDataWithMetadata(sampleActivitiesWithRepetiveResponse, sampleMetadataResponse);

        const expected = [
            {
                uiType: "date",
                value: "2024-09-25 - 2024-09-26",
            },
            {
                actions: [],
                activities: {
                    displayableName: "Scenario unarchived",
                    icon: "/assets/process/success.svg",
                    supportedActions: [],
                    type: "SCENARIO_UNARCHIVED",
                },
                additionalFields: [],
                attachment: null,
                comment: null,
                date: "2024-09-26T10:26:42.999982Z",
                id: "1ba9d6c6-c61a-42f5-8311-4d0f287867f7",
                isActiveFound: false,
                isFound: false,
                isHidden: false,
                overrideDisplayableName: null,
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 6,
                type: "SCENARIO_UNARCHIVED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [],
                activities: {
                    displayableName: "Scenario archived",
                    icon: "/assets/process/archived.svg",
                    supportedActions: [],
                    type: "SCENARIO_ARCHIVED",
                },
                additionalFields: [],
                attachment: null,
                comment: null,
                date: "2024-09-26T10:26:28.293423Z",
                id: "ec245dc5-f84c-4880-8727-b8c999c35a3f",
                isActiveFound: false,
                isFound: false,
                isHidden: false,
                overrideDisplayableName: null,
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 6,
                type: "SCENARIO_ARCHIVED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_comment",
                    },
                    {
                        displayableName: "Edit",
                        icon: "/assets/states/error.svg",
                        id: "edit_comment",
                    },
                    {
                        displayableName: "Compare",
                        icon: "/assets/states/error.svg",
                        id: "compare",
                    },
                ],
                activities: {
                    displayableName: "New version saved",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["delete_comment", "edit_comment", "compare"],
                    type: "SCENARIO_MODIFIED",
                },
                additionalFields: [],
                attachment: null,
                comment: {
                    content: {
                        status: "AVAILABLE",
                        value: "Scenario migrated from local by admin",
                    },
                    lastModifiedAt: "2024-09-26T10:22:45.494475Z",
                    lastModifiedBy: "admin",
                },
                date: "2024-09-26T10:22:45.494475Z",
                id: "4e8c9f40-7c2c-434e-8528-68dccf66d5d1",
                isActiveFound: false,
                isFound: false,
                isHidden: false,
                overrideDisplayableName: "Version 6 saved",
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 6,
                type: "SCENARIO_MODIFIED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_comment",
                    },
                    {
                        displayableName: "Edit",
                        icon: "/assets/states/error.svg",
                        id: "edit_comment",
                    },
                    {
                        displayableName: "Compare",
                        icon: "/assets/states/error.svg",
                        id: "compare",
                    },
                ],
                activities: {
                    displayableName: "New version saved",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["delete_comment", "edit_comment", "compare"],
                    type: "SCENARIO_MODIFIED",
                },
                additionalFields: [],
                attachment: null,
                comment: {
                    content: {
                        status: "AVAILABLE",
                        value: "Scenario migrated from local by admin",
                    },
                    lastModifiedAt: "2024-09-26T10:13:11.571064Z",
                    lastModifiedBy: "admin",
                },
                date: "2024-09-26T10:13:11.571064Z",
                id: "35fa34fe-7f07-4b50-98fb-58d19d5b7704",
                isActiveFound: false,
                isFound: false,
                isHidden: true,
                overrideDisplayableName: "Version 6 saved",
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 6,
                type: "SCENARIO_MODIFIED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_comment",
                    },
                    {
                        displayableName: "Edit",
                        icon: "/assets/states/error.svg",
                        id: "edit_comment",
                    },
                    {
                        displayableName: "Compare",
                        icon: "/assets/states/error.svg",
                        id: "compare",
                    },
                ],
                activities: {
                    displayableName: "New version saved",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["delete_comment", "edit_comment", "compare"],
                    type: "SCENARIO_MODIFIED",
                },
                additionalFields: [],
                attachment: null,
                comment: {
                    content: {
                        status: "AVAILABLE",
                        value: "Scenario migrated from local by admin",
                    },
                    lastModifiedAt: "2024-09-26T10:11:29.657265Z",
                    lastModifiedBy: "admin",
                },
                date: "2024-09-26T10:11:29.657265Z",
                id: "c0745a74-937c-4682-b9c8-cb94f619eb14",
                isActiveFound: false,
                isFound: false,
                isHidden: true,
                overrideDisplayableName: "Version 6 saved",
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 6,
                type: "SCENARIO_MODIFIED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_comment",
                    },
                    {
                        displayableName: "Edit",
                        icon: "/assets/states/error.svg",
                        id: "edit_comment",
                    },
                    {
                        displayableName: "Compare",
                        icon: "/assets/states/error.svg",
                        id: "compare",
                    },
                ],
                activities: {
                    displayableName: "New version saved",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["delete_comment", "edit_comment", "compare"],
                    type: "SCENARIO_MODIFIED",
                },
                additionalFields: [],
                attachment: null,
                comment: {
                    content: {
                        status: "AVAILABLE",
                        value: "test12345",
                    },
                    lastModifiedAt: "2024-09-26T10:08:00.895385Z",
                    lastModifiedBy: "admin",
                },
                date: "2024-09-26T10:08:00.895385Z",
                id: "2cf1f252-3be1-413f-ad62-ccb311683744",
                isActiveFound: false,
                isFound: false,
                isHidden: true,
                overrideDisplayableName: "Version 6 saved",
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 6,
                type: "SCENARIO_MODIFIED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_comment",
                    },
                    {
                        displayableName: "Edit",
                        icon: "/assets/states/error.svg",
                        id: "edit_comment",
                    },
                    {
                        displayableName: "Compare",
                        icon: "/assets/states/error.svg",
                        id: "compare",
                    },
                ],
                activities: {
                    displayableName: "New version saved",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["delete_comment", "edit_comment", "compare"],
                    type: "SCENARIO_MODIFIED",
                },
                additionalFields: [],
                attachment: null,
                comment: {
                    content: {
                        status: "AVAILABLE",
                        value: "test",
                    },
                    lastModifiedAt: "2024-09-26T07:17:19.892192Z",
                    lastModifiedBy: "admin",
                },
                date: "2024-09-26T07:17:19.892192Z",
                id: "0182764d-c568-403e-88ea-24942a091af5",
                isActiveFound: false,
                isFound: false,
                isHidden: true,
                overrideDisplayableName: "Version 5 saved",
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 5,
                type: "SCENARIO_MODIFIED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_comment",
                    },
                    {
                        displayableName: "Edit",
                        icon: "/assets/states/error.svg",
                        id: "edit_comment",
                    },
                    {
                        displayableName: "Compare",
                        icon: "/assets/states/error.svg",
                        id: "compare",
                    },
                ],
                activities: {
                    displayableName: "New version saved",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["delete_comment", "edit_comment", "compare"],
                    type: "SCENARIO_MODIFIED",
                },
                additionalFields: [],
                attachment: null,
                comment: {
                    content: {
                        status: "AVAILABLE",
                        value: "122",
                    },
                    lastModifiedAt: "2024-09-25T09:55:04.309Z",
                    lastModifiedBy: "admin",
                },
                date: "2024-09-25T09:55:04.309Z",
                id: "15c0e8a9-d1c5-47dd-bf28-8a08217fff5b",
                isActiveFound: false,
                isFound: false,
                isHidden: true,
                overrideDisplayableName: "Version 4 saved",
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 4,
                type: "SCENARIO_MODIFIED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_comment",
                    },
                    {
                        displayableName: "Edit",
                        icon: "/assets/states/error.svg",
                        id: "edit_comment",
                    },
                    {
                        displayableName: "Compare",
                        icon: "/assets/states/error.svg",
                        id: "compare",
                    },
                ],
                activities: {
                    displayableName: "New version saved",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["delete_comment", "edit_comment", "compare"],
                    type: "SCENARIO_MODIFIED",
                },
                additionalFields: [],
                attachment: null,
                comment: {
                    content: {
                        status: "AVAILABLE",
                        value: "tests save",
                    },
                    lastModifiedAt: "2024-09-25T09:53:40.875721Z",
                    lastModifiedBy: "admin",
                },
                date: "2024-09-25T09:53:40.875721Z",
                id: "a2576467-9bf9-4a92-b71f-be95b84d59f6",
                isActiveFound: false,
                isFound: false,
                isHidden: true,
                overrideDisplayableName: "Version 3 saved",
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 3,
                type: "SCENARIO_MODIFIED",
                uiType: "item",
                user: "admin",
            },
            {
                isClicked: false,
                sameItemOccurrence: 6,
                uiType: "moreItemsButton",
            },
            {
                actions: [
                    {
                        displayableName: "Download",
                        icon: "/assets/states/error.svg",
                        id: "download_attachment",
                    },
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_attachment",
                    },
                ],
                activities: {
                    displayableName: "Attachment",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["download_attachment", "delete_attachment"],
                    type: "ATTACHMENT_ADDED",
                },
                additionalFields: [],
                attachment: {
                    file: {
                        id: 1,
                        status: "AVAILABLE",
                    },
                    filename: "324.log",
                    lastModifiedAt: "2024-09-25T06:09:44.313094Z",
                    lastModifiedBy: "admin",
                },
                comment: null,
                date: "2024-09-25T06:09:44.313094Z",
                id: "48f383f9-ccdd-46b6-9b33-5f6693165755",
                isActiveFound: false,
                isFound: false,
                isHidden: false,
                overrideDisplayableName: null,
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 1,
                type: "ATTACHMENT_ADDED",
                uiType: "item",
                user: "admin",
            },
            {
                actions: [
                    {
                        displayableName: "Delete",
                        icon: "/assets/states/error.svg",
                        id: "delete_comment",
                    },
                    {
                        displayableName: "Edit",
                        icon: "/assets/states/error.svg",
                        id: "edit_comment",
                    },
                ],
                activities: {
                    displayableName: "Comment",
                    icon: "/assets/states/success.svg",
                    supportedActions: ["delete_comment", "edit_comment"],
                    type: "COMMENT_ADDED",
                },
                additionalFields: [],
                attachment: null,
                comment: {
                    content: {
                        status: "AVAILABLE",
                        value: "test",
                    },
                    lastModifiedAt: "2024-09-25T06:09:03.470213Z",
                    lastModifiedBy: "admin",
                },
                date: "2024-09-25T06:09:03.470213Z",
                id: "56a7dd49-778b-468b-8e33-99bd176218aa",
                isActiveFound: false,
                isFound: false,
                isHidden: false,
                overrideDisplayableName: null,
                overrideIcon: null,
                overrideSupportedActions: null,
                scenarioVersionId: 1,
                type: "COMMENT_ADDED",
                uiType: "item",
                user: "admin",
            },
        ];

        expect(extendActivitiesWithUIData(activitiesDataWithMetadata)).toMatchObject(expected);
    });
});
