version: '3.7'

services:
  nussknacker:
    container_name: e2e_nussknacker_customerservice
    image: touk/nussknacker:${NUSSKNACKER_VERSION:-staging-latest}
    ports:
      - ${BE_PORT:-8080}:8080
    environment:
      - CONFIG_FORCE_usageStatisticsReports_enabled=false
      - SCHEMA_REGISTRY_URL=http://dummy:8888
      - KAFKA_ADDRESS=dummy:9092
      - OPENAPI_SERVICE_URL=http://dummy:5000
      - SQL_ENRICHER_URL=dummy:5432
      - CONFIG_FORCE_scenarioTypes_streaming__dev_deploymentConfig_type=stub
      - CONFIG_FILE=/opt/nussknacker/conf/dev-application.conf
    volumes:
      - ./../../nussknacker-dist/src/universal/conf/dev-application.conf:/opt/nussknacker/conf/dev-application.conf

  schemaregistry:
    container_name: e2e_schemaregistry_customerservice
    image: confluentinc/cp-schema-registry:7.3.0
    environment:
      SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: kafka:9092
      SCHEMA_REGISTRY_HOST_NAME: schemaregistry
    ports:
      - "4081:8081"

networks:
  default:
    name: nussknacker_e2e_network_customerservice